# 串行任务执行计划

本文档列出必须严格按顺序执行的任务。这些任务位于关键路径上，或因接口契约、集成点等原因不可并行。

---

## 1. 串行执行原则

以下情况必须串行执行：

1. **接口契约定义**: 下游任务依赖上游接口定义
2. **集成点**: 多个组件的集成测试
3. **Gate 检查点**: 每个 Gate 的入口/出口验证
4. **配置依赖**: 配置加载必须先于使用配置的任务

---

## 2. Gate 0: 基础设施与契约

### 串行链 S0: 项目基础

```
S0: T-001 → T-002 → T-004
         ↘ T-003 → T-006
              ↘ T-005
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 1 | T-001 | 项目初始化 | 所有任务的基础 |
| 2 | T-002 | 核心接口定义 | 定义 Generator/Parser/Validator 接口 |
| 3 | T-003 | 配置加载器 | 与 T-002 可并行，但建议同步 |
| 4 | T-004 | 数据模型定义 | 依赖 T-002 的接口定义 |
| 5 | T-005 | 错误处理框架 | 依赖 T-002 的接口定义 |
| 6 | T-006 | 版本注册器 | 依赖 T-003 的配置基础 |

**Gate 0 完成检查点**:
- [ ] 所有接口编译通过
- [ ] 配置文件加载成功
- [ ] 数据模型单元测试通过
- [ ] 错误码定义完整

---

## 3. Gate 1: 最小垂直切片 MVP

### 串行链 S1: Excel 解析核心链

```
S1: T-101 → T-102 → T-103 → T-104 → T-105 → T-106 → T-107
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 1 | T-101 | 列名规范化器 | 处理 Excel 列名的基础 |
| 2 | T-102 | Sheet 发现与验证 | 依赖列名规范化 |
| 3 | T-103 | 元数据提取器 | 依赖 Sheet 验证 |
| 4 | T-104 | Seg lvl 嵌套算法 | 依赖元数据提取 |
| 5 | T-105 | 对象/数组检测 | 依赖嵌套算法 |
| 6 | T-106 | 命名规范化 | 依赖对象/数组检测 |
| 7 | T-107 | Excel 解析器集成 | 集成所有解析组件 |

### 串行链 S2: JSON 到 XML 生成链

```
S2: T-108 → T-109 → T-110 → T-111
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 8 | T-108 | JSON Tree 序列化 | 依赖解析器集成 |
| 9 | T-109 | XML 字段类型映射 | 依赖 JSON Tree |
| 10 | T-110 | XML 模板引擎 | 依赖类型映射 |
| 11 | T-111 | Outbound XML 生成器 | 依赖模板引擎 |

**Gate 1 完成检查点**:
- [ ] create_app.xlsx 解析成功
- [ ] spec-tree.json 生成且字段顺序正确
- [ ] outbound-converter.xml 生成且格式正确
- [ ] transitory 字段（groupId, occurrenceCount）正确包含

---

## 4. Gate 2: 响应与 OpenAPI

### 串行链 S3: Response 与 Inbound XML

```
S3: T-201 → T-202
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 12 | T-201 | Response Sheet 解析 | 扩展 Excel 解析器 |
| 13 | T-202 | Inbound XML 生成器 | 依赖 Response 解析 |

### 串行链 S4: Java Bean 生成链

```
S4: T-203 → T-204 → T-205 → T-206
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 14 | T-203 | Java 类型映射 | 类型映射规则定义 |
| 15 | T-204 | Java Bean 生成器 | 依赖类型映射 |
| 16 | T-205 | 嵌套类生成 | 依赖 Bean 生成器 |
| 17 | T-206 | 枚举辅助方法生成 | 依赖嵌套类生成 |

### 串行链 S5: OpenAPI 生成链

```
S5: T-207 → T-208 → T-209
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 18 | T-207 | OpenAPI Schema 映射 | 类型映射规则定义 |
| 19 | T-208 | OpenAPI 主文件生成 | 依赖 Schema 映射 |
| 20 | T-209 | OpenAPI Schema 拆分 | 依赖主文件生成 |

### 串行链 S6: diff.md 生成

```
S6: T-210
```

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 21 | T-210 | diff.md 生成器 | 依赖 JSON Tree |

**Gate 2 完成检查点**:
- [ ] inbound-converter.xml 生成正确
- [ ] Request/Response Java Bean 生成且可编译
- [ ] Java Bean 不包含 groupId/occurrenceCount
- [ ] api.yaml 生成且通过 OAS 3.0 验证
- [ ] schemas 目录结构正确
- [ ] diff.md 包含所有字段映射

---

## 5. Gate 3: 验证器与 CI 硬化

### 串行链 S7: 验证器链

```
S7: T-304 (依赖 T-301, T-302, T-303)
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 22 | T-301 | XML Bean 验证器 | 可并行 |
| 22 | T-302 | Java Bean 验证器 | 可并行 |
| 22 | T-303 | OpenAPI 验证器 | 可并行 |
| 23 | T-304 | 跨制品一致性验证 | 依赖所有验证器 |

### 串行链 S8: 报文验证链

```
S8: T-305 → T-306
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 24 | T-305 | 偏移量计算器 | 报文解析基础 |
| 25 | T-306 | 报文验证器 | 依赖偏移量计算 |

### 串行链 S9: 输出与集成链

```
S9: T-307 → T-308 → T-309 → T-310
```

**执行顺序**:

| 顺序 | Task ID | 任务名称 | 阻塞原因 |
|------|---------|---------|---------|
| 26 | T-307 | 原子输出管理器 | 集成所有生成器 |
| 27 | T-308 | 审计日志记录器 | 依赖输出管理器 |
| 28 | T-309 | CLI 入口点 | 集成所有组件 |
| 29 | T-310 | 端到端集成测试 | 最终验证 |

**Gate 3 完成检查点**:
- [ ] VR-101 ~ VR-109 验证规则全部实现
- [ ] 跨制品一致性验证通过
- [ ] 报文验证报告生成正确
- [ ] 审计日志包含所有必需字段
- [ ] 失败时正确回滚，无部分输出
- [ ] 端到端测试覆盖所有验收标准

---

## 6. 关键路径总结

**完整串行执行顺序（29 个任务）**:

```
Gate 0 (6): T-001 → T-002 → T-003 → T-004 → T-005 → T-006
Gate 1 (11): T-101 → T-102 → T-103 → T-104 → T-105 → T-106 → T-107 → T-108 → T-109 → T-110 → T-111
Gate 2 (10): T-201 → T-202 | T-203 → T-204 → T-205 → T-206 | T-207 → T-208 → T-209 | T-210
Gate 3 (8): T-301/T-302/T-303 → T-304 | T-305 → T-306 | T-307 → T-308 → T-309 → T-310
```

**最长路径（21 个任务）**:

```
T-001 → T-002 → T-004 → T-101 → T-102 → T-103 → T-104 → T-105 → T-106 → T-107 → T-108 → T-203 → T-204 → T-205 → T-206 → T-302 → T-304 → T-307 → T-308 → T-309 → T-310
```

---

## 7. 串行任务执行检查清单

### Gate 0 完成确认

- [ ] T-001 项目初始化 - 完成
- [ ] T-002 核心接口定义 - 完成
- [ ] T-003 配置加载器 - 完成
- [ ] T-004 数据模型定义 - 完成
- [ ] T-005 错误处理框架 - 完成
- [ ] T-006 版本注册器 - 完成
- [ ] **Gate 0 检查点验证通过**

### Gate 1 完成确认

- [ ] T-101 ~ T-111 全部完成
- [ ] spec-tree.json 输出验证
- [ ] outbound-converter.xml 输出验证
- [ ] **Gate 1 检查点验证通过**

### Gate 2 完成确认

- [ ] T-201 ~ T-210 全部完成
- [ ] 所有制品生成验证
- [ ] **Gate 2 检查点验证通过**

### Gate 3 完成确认

- [ ] T-301 ~ T-310 全部完成
- [ ] 端到端测试通过
- [ ] **Gate 3 检查点验证通过**
- [ ] **项目交付完成**

---

**文档结束**
